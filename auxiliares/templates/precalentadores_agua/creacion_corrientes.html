{% extends 'base.html' %}
{% load static %}
{% load widget_tweaks %}

{% block head %}
<script src="/static/js/htmx.min.js"></script>
<link rel="stylesheet" href="{% static 'css/htmx-indicator.css' %}">
{% endblock %}

{% block contenido %}
<form method="post" enctype="multipart/form-data">
    {{ forms_corrientes.management_form }}

    {% csrf_token %}
    <div class="row">
        <div class="col-md-3 col-lg-2 d-inline-flex justify-content-center align-items-center">
            <a class="btn d-block btn-secondary" href="{% url 'consulta_turbinas_vapor' %}">↶ Regresar</a>
        </div>
        <div class="col-md-6 col-lg-8">
            {% if not form_turbina.instance.pk %}
            <h3 class="text-center" style="color: #e31e24;">Registro de Nueva Turbina de Vapor</h3>
            {% else %}
            <h3 class="text-center" style="color: #e31e24;">Edición de Turbina de Vapor</h3>
            {% endif %}
        </div>
        <div class="col-3"></div>
    </div>

    <hr>
    
    {% if error %}
    <h5 class="text-center" style="color: #e31e24;">{{error}}</h5>
    <hr>
    {% endif %}

    <h4 class="text-center" style="color: #e31e24;">Corrientes del Lado de la Carcasa</h2>
    
    <hr>

    <h4 class="text-center" style="color: #e31e24;">Corrientes del Lado del Tubo</h2>
        

        <div class="text-center">
            <h4 class="text-center mb-0" style="color: #e31e24;">Datos de los Corrientes</h4>
            <small>Los datos deben ser ingresados de forma manual ya que corresponden al diseño.</small>
        </div>

            <table class="table">
                <tbody id="forms-corrientes">
                    <tr>
                        <th class="text-center">#</th>
                        <th class="text-center">Descripción</th>
                        <th class="text-center">Entrada</th>
                        <th class="text-center">Flujo</th>
                        <th class="text-center">Entalpía</th>
                        <th class="text-center">Presión</th>
                        <th class="text-center">Temperatura</th>
                        <th class="text-center">Fase</th>
                        <th class="text-center">+/-</th>
                    </tr>

                    <tr>
                        <th class="text-center">-</td>
                        <td class="text-center">-</td>
                        <td class="text-center">-</td>
                        <td class="text-center">
                            <select name="flujo_unidad" id="id_flujo_unidad" class="form-select">
                                {% include 'unidades.html' with tipo="F" pk_selected=form_datos_corrientes.instance.flujo_unidad.pk %}
                            </select>
                        </td>
                        <td class="text-center">
                            <select name="entalpia_unidad" id="id_entalpia_unidad" class="form-select">
                                {% include 'unidades.html' with tipo="n" pk_selected=form_datos_corrientes.instance.entalpia_unidad.pk %}
                            </select>
                        </td>
                        <td class="text-center">
                            <select name="presion_unidad" id="id_presion_unidad" class="form-select">
                                {% include 'unidades.html' with tipo="P" pk_selected=form_datos_corrientes.instance.presion_unidad.pk %}
                            </select>
                        </td>
                        <td class="text-center">
                            <select name="temperatura_unidad" id="id_temperatura_unidad" class="form-select">
                                {% include 'unidades.html' with tipo="T" pk_selected=form_datos_corrientes.instance.temperatura_unidad.pk %}
                            </select>
                        </td>
                        <td class="text-center">-</td>
                        <td class="text-center">-</td>
                    </tr>

                    {% for form in forms_corrientes %}
                    {% for field in form.hidden_fields %}
                        {{ field }}
                    {% endfor %}
                    <tr class="form">
                        <td>
                            {% render_field form.numero_corriente class="form-control numero-corriente" placeholder="Número de la Corriente" %}
                            <small>{{form.numero_corriente.errors}}</small>
                        </td>
                        <td>
                            {% render_field form.descripcion_corriente class="form-control" placeholder="Descripción de la Corriente" %}
                            <small>{{form.descripcion_corriente.errors}}</small>
                        </td>
                        <td>
                            <div class="d-flex justify-content-center align-items-center h-100">
                                {% if form.instance %}
                                {% if form.instance.entrada %}
                                {% render_field form.entrada class="form-check-input entrada" min="0.00001" %}
                                {% else %}
                                {% render_field form.entrada class="form-check-input entrada" min="0.00001" %}
                                {% endif %}
                                {% else %}
                                {% render_field form.entrada class="form-check-input entrada" min="0.00001" %}
                                {% endif %}

                            </div>
                            <small>{{form.entrada.errors}}</small>
                        </td>
                        <td>
                            {% render_field form.flujo class="form-control flujo" placeholder="Flujo" required="required" min="0.00001" %}
                            <small>{{form.flujo.errors}}</small>
                        </td>
                        <td>
                            {% render_field form.entalpia class="form-control" placeholder="Entalpía" required="required" min="0.00001" %}
                            <small>{{form.entalpia.errors}}</small>
                        </td>
                        <td>
                            {% render_field form.presion class="form-control presion" placeholder="Presión (Manométrica)" min="0.00001" %}
                            <small>{{form.presion.errors}}</small>
                        </td>
                        <td>
                            {% render_field form.temperatura class="form-control" placeholder="Temperatura" required="required" min="-273.15" %}
                            <small>{{form.temperatura.errors}}</small>
                        </td>
                        <td>
                            {% render_field form.fase class="form-select" placeholder="Fase" required="required" %}
                            <small>{{form.fase.errors}}</small>
                        </td>
                        <td>
                            {% if forloop.first %}
                            <a class="anadir w-100 btn btn-success">+</a>
                            {% else %}
                            <a class="eliminar w-100 btn btn-danger">-</a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
                
            <hr>

            <div class="d-flex w-100 justify-content-center mb-3">
                <button id="submit" type="submit" class="btn btn-danger">Enviar Formulario</button>
            </div>
</form>

<div id="spinner" class="htmx-indicator indicator-style">
    <div class="spinner-grow text-danger" style="width: 6rem; height: 6rem;">
    </div>
</div>
{% endblock %}

{% block extra_javascript %}
<script src="/static/js/turbinas/creacion.js"></script>

{% if form_turbina.instance.tag %}
<script>
    $('.entrada').change();
</script>
{% endif %}

<script>
    $('select[name="presion_unidad"]').html($('select[name="presion_unidad"]').html().replaceAll('</option>', 'g</option>'));
</script>
{% endblock %}