{% extends 'base.html' %}
{% load static %}

{% block contenido %}
    <form method="post" onsubmit="return validarForm(this);">
        {% csrf_token %}
        <div class="row">
            <div class="col-md-3 col-lg-2 d-inline-flex justify-content-center align-items-center"><a class="btn d-block btn-secondary" href="{% url 'consulta_doble_tubo' %}">↶ Regresar</a></div>
            <div class="col-md-6 col-lg-8"><h3 class="text-center" style="color: #e31e24;">Nuevo Intercambiador de Doble Tubo</h3></div>
            <div class="col-3"></div>
        </div>
    
        <hr>

        {% if errores %}
        <div>
            {% for error in errores %}
            <ul>
                <li class="text-center" style="color: #e31e24;">{{error}}</li>
            </ul>
            {%endfor%}
        </div>

        <hr>
        {% endif %}
    
        <div class="row">
            <div class="col-12">
                <h5 class="text-center" style="color: #e31e24;">Datos de Identificación</h5>
            </div>

            <div class="col-3 d-flex flex-column">
                <label class="form-label" for="complejo">Complejo:</label>
                <select required class="form-select" name="complejo" id="complejo">
                    {% for complejo in complejos %}
                    <option value="{{complejo.pk}}" {% if previo.complejo == complejo.pk|slugify %}selected{% endif %}>{{complejo}}</option>
                    {% endfor %}
                </select>
            </div>
    
            <div class="col-3 d-flex flex-column">
                <label class="form-label" for="planta">Planta:</label>
                <select required class="form-select" name="planta" id="planta">
                    {% for planta in plantas %}
                    <option value="{{planta.pk}}" {% if previo.planta == planta.pk|slugify %}selected{% endif %}>{{planta}}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-3 d-flex flex-column">
                <label class="form-label" for="tema">Tipo:</label>
                <select class="form-select" name="tema" id="tema">
                    {% for tema in temas %}
                    <option value="{{tema.pk}}" {% if previo.tema == tema.pk|slugify %}selected{% endif %}>{{tema}}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-3 d-flex flex-column">
                <label class="form-label" for="tag">Tag del Equipo:</label>
                <input maxlength="50" value="{{previo.tag}}" type="text" required class="form-control" name="tag" id="tag">
            </div>

            <div class="col-3 d-flex flex-column">
                <label class="form-label" for="servicio">Servicio:</label>
                <input maxlength="100" value="{{previo.servicio}}" type="text" required class="form-control" name="servicio" id="servicio">
            </div>
            
            <div class="col-3 d-flex flex-column">
                <label class="form-label" for="flujo">Flujo:</label>
                <select class="form-select" name="flujo" id="flujo">
                    <option value="C" {% if previo.flujo == "C" %}selected{% endif %}>Cocorriente</option>
                    <option value="c" {% if previo.flujo == "c" %}selected{% endif %}>Contracorriente</option>
                </select>
            </div>

            <div class="col-3 d-flex flex-column">
                <label class="form-label" for="fabricante">Fabricante:</label>
                <input maxlength="45" value="{{previo.fabricante}}" type="text" required class="form-control" name="fabricante" id="fabricante">
            </div>

            <div class="col-3 d-flex flex-column">
                <label class="form-label" for="criticidad">Criticidad:</label>
                <select class="form-select" name="criticidad" id="criticidad">
                    <option value="N" {% if previo.criticidad == "N" %}selected{% endif %}>No Crítico</option>
                    <option value="S" {% if previo.criticidad == "S" %}selected{% endif %}>Semi Crítico</option>
                    <option value="C" {% if previo.criticidad == "C" %}selected{% endif %}>Crítico</option>
                </select>
            </div>
        </div>
    
        <hr>
    
        <div class="row g-3">
            <div class="col-12">
                <h5 class="text-center" style="color: #e31e24;">Datos de Condiciones de Diseño</h5>
            </div>

            <div class="col-6 border-end">
                <h4 class="text-center mb-3">Tubo Externo</h4>
    
                <div class="row">
                    <div class="col-6">
                        <label class="form-label" for="cambio_fase_carcasa">Cambio de Fase:</label>
                        <div class="input-group mb-3">
                            <select disabled class="form-select" name="cambio_fase_carcasa" id="cambio_fase_carcasa">
                                <option value="-">-</option>
                                <option value="S" {% if previo.cambio_fase_carcasa == "S" %}selected{% endif %}>Sin Cambio de Fase</option>
                                <option value="P" {% if previo.cambio_fase_carcasa == "P" %}selected{% endif %}>Cambio de Fase Parcial</option>
                                <option value="T" {% if previo.cambio_fase_carcasa == "T" %}selected{% endif %}>Cambio de Fase Total</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-6">
                        <label class="form-label" for="flujo_carcasa">Flujo Másico:</label>
                        <div class="input-group mb-3">
                            <input disabled min="0.01" value="{{previo.flujo_carcasa}}" style="width: 60% !important;" class="form-control" type="number" name="flujo_carcasa" id="flujo_carcasa" step="0.01" max="99999999.99" required>
                            <select style="width: 40% !important;" class="form-select" name="unidad_flujos" id="unidad_flujos">
                                {% for unidad in unidades_flujo %}
                                <option value="{{unidad.pk|slugify}}" {% if previo.unidad_flujos == unidad.pk|slugify %}selected{%endif%}>{{unidad.simbolo}}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="col-6">
                        <label class="form-label" for="flujo_vapor_in_carcasa">Flujo de Vapor Entrada:</label>
                        <div class="input-group mb-3">
                            <input value="{{previo.flujo_vapor_in_carcasa}}" style="width: 60% !important;" class="form-control" type="number" name="flujo_vapor_in_carcasa" id="flujo_vapor_in_carcasa" step="0.01" max="99999999.99" required>
                            <select style="width: 40% !important;" class="form-select" name="unidad_flujos" id="unidad_flujos" disabled>
                                {% if previo.unidad_flujos %}
                                {% for unidad in unidades_flujo %}
                                {% if unidad.pk|slugify == previo.unidad_flujos %}
                                <option>{{unidad}}</option>
                                {%endif%}
                                {% endfor %}
                                {% else %}
                                <option value="1">Kg/h</option>
                                {%endif%}
                            </select>
                        </div>
                    </div>

                    <div class="col-6">
                        <label class="form-label" for="flujo_vapor_out_carcasa">Flujo de Vapor Salida:</label>
                        <div class="input-group mb-3">
                            <input value="{{previo.flujo_vapor_out_carcasa}}" style="width: 60% !important;" class="form-control" type="number" name="flujo_vapor_out_carcasa" id="flujo_vapor_out_carcasa" step="0.01" max="99999999.99" required>
                            <select style="width: 40% !important;" class="form-select" name="unidad_flujos" id="unidad_flujos" disabled>
                                {% if previo.unidad_flujos %}
                                {% for unidad in unidades_flujo %}
                                {% if unidad.pk|slugify == previo.unidad_flujos %}
                                <option>{{unidad}}</option>
                                {%endif%}
                                {% endfor %}
                                {% else %}
                                <option value="1">Kg/h</option>
                                {%endif%}
                            </select>
                        </div>
                    </div>

                    <div class="col-6">
                        <label class="form-label" for="flujo_liquido_in_carcasa">Flujo Líquido Entrada:</label>
                        <div class="input-group mb-3">
                            <input value="{{previo.flujo_liquido_in_carcasa}}" style="width: 60% !important;" class="form-control" type="number" name="flujo_liquido_in_carcasa" id="flujo_liquido_in_carcasa" step="0.01" max="99999999.99" required>
                            <select style="width: 40% !important;" class="form-select" name="unidad_flujos" id="unidad_flujos" disabled>
                                {% if previo.unidad_flujos %}
                                {% for unidad in unidades_flujo %}
                                {% if unidad.pk|slugify == previo.unidad_flujos %}
                                <option>{{unidad}}</option>
                                {%endif%}
                                {% endfor %}
                                {% else %}
                                <option value="1">Kg/h</option>
                                {%endif%}
                            </select>
                        </div>
                    </div>

                    <div class="col-6">
                        <label class="form-label" for="flujo_liquido_out_carcasa">Flujo Líquido Salida:</label>
                        <div class="input-group mb-3">
                            <input value="{{previo.flujo_liquido_out_carcasa}}" style="width: 60% !important;" class="form-control" type="number" name="flujo_liquido_out_carcasa" id="flujo_liquido_out_carcasa" step="0.01" max="99999999.99" required>
                            <select style="width: 40% !important;" class="form-select" name="unidad_flujos" id="unidad_flujos" disabled>
                                {% if previo.unidad_flujos %}
                                {% for unidad in unidades_flujo %}
                                {% if unidad.pk|slugify == previo.unidad_flujos %}
                                <option>{{unidad}}</option>
                                {%endif%}
                                {% endfor %}
                                {% else %}
                                <option value="1">Kg/h</option>
                                {%endif%}
                            </select>
                        </div>
                    </div>
                    
                    <div class="col-12">
                        <label class="form-label" for="presion_entrada_carcasa">Presión Entrada:</label>
                        <div class="input-group mb-3">
                            <input value="{{previo.presion_entrada_carcasa}}" style="width: 80% !important;" class="form-control" type="number" name="presion_entrada_carcasa" id="presion_entrada_carcasa" step="0.01" max="99999999.99" required>
                            <select style="width: 20% !important;" class="form-select" name="unidad_presiones" id="unidad_presiones">
                                {% for unidad in unidades_presion %}
                                <option value="{{unidad.pk|slugify}}" {% if previo.unidad_presiones == unidad.pk|slugify %}selected{%endif%}>{{unidad.simbolo}}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="col-6">
                        <label class="form-label" for="temp_in_carcasa">Temperatura Entrada:</label>
                        <div class="input-group mb-3">
                            <input value="{{previo.temp_in_carcasa}}" style="width: 60% !important;" class="form-control" type="number" name="temp_in_carcasa" id="temp_in_carcasa" step="0.01" max="99999.99" required>
                            <select style="width: 40% !important;" class="form-select" name="unidad_temperaturas" id="unidad_temperaturas">
                                {% for unidad in unidades_temperaturas %}
                                <option value="{{unidad.pk|slugify}}">{{unidad.simbolo}}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="col-6">
                        <label class="form-label" for="temp_out_carcasa">Temperatura Salida:</label>
                        <div class="input-group mb-3">
                            <input value="{{previo.temp_out_carcasa}}" style="width: 60% !important;" class="form-control" type="number" name="temp_out_carcasa" id="temp_out_carcasa" step="0.01" max="99999.99" required>
                            <select style="width: 40% !important;" class="form-select" name="unidad_temperaturas" id="unidad_temperaturas" disabled>
                                {% if previo.unidad_temperaturas %}
                                {% for unidad in unidades_temperaturas %}
                                {% if unidad.pk|slugify == previo.unidad_temperaturas %}
                                <option>{{unidad}}</option>
                                {%endif%}
                                {% endfor %}
                                {% else %}
                                <option value="1">°C</option>
                                {%endif%}
                            </select>
                        </div>
                    </div>

                    <div class="col-12 d-flex justify-content-center mb-2">
                        <div style="width: 50%;">
                            <label for="tipo_cp_carcasa">Cálculo del Cp:</label>
                            <select class="form-select" name="tipo_cp_carcasa" id="tipo_cp_carcasa">
                                <option value="A" {% if previo.tipo_cp_carcasa == 'A' %} selected {% endif %}>Automático</option>
                                <option value="M" {% if previo.tipo_cp_carcasa == 'M' %} selected {% endif %}>Manual</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="row">
                            <div class="col-12">
                                <label class="form-label" for="fluido_carcasa">Fluido:</label>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-12 mb-2">
                                <div class="row">
                                    <div class="col-8 d-flex flex-column">    
                                        <select class="form-select" name="fluido_carcasa" id="fluido_carcasa">
                                            {% for fluido in fluidos %}
                                            <option value="{{fluido.pk}}" {% if previo.fluido_carcasa == fluido.pk|slugify %}selected{% endif %}>{{fluido}}</option>
                                            {% endfor %}
                                            {% if previo.fluido_carcasa_etiqueta %}
                                            <option value="{{previo.fluido_carcasa}}" selected>{{previo.fluido_carcasa_etiqueta}}</option>
                                            {%endif%}
                                        </select>
                                    </div>
                            
                                    <div class="col-4 d-flex justify-content-center align-items-start">
                                        <button data-bs-toggle="modal" data-bs-target="#condiciones_diseno_fluido_carcasa" class="btn btn-danger no-submit w-100">+</button>
                                        <div class="modal fade" id="condiciones_diseno_fluido_carcasa" tabindex="-1" aria-labelledby="condiciones_diseno_fluido_carcasaLabel" aria-hidden="true">
                                            <div class="modal-dialog modal-lg modal-dialog-centered">
                                              <div class="modal-content">
                                                <div class="modal-header">
                                                  <h5 class="modal-title">Registrar Fluido de Carcasa</h5>
                                                  <button id="condiciones_diseno_fluido_carcasaClose" type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <h3 style="color: #e31e24;" class="text-center">Compuesto por Cp en Ficha</h3>
                                                    <div class="row">
                                                        <div class="col-5">
                                                            <label for="etiqueta">Nombre del Compuesto:</label>
                                                            <input class="form-control" id="nombre_compuesto_carcasa" type="text" maxlength="25">
                                                        </div>
                                                        <div class="col-5">
                                                            <label for="etiqueta">Cp del Compuesto:</label>
                                                            <input class="form-control" id="cp_compuesto_carcasa" type="number" step="0.0001">
                                                        </div>
                                                        <div class="col-2 d-flex justify-content-center align-items-end">
                                                            <button id="enviar_compuesto_carcasa_ficha" class="no-submit btn btn-danger w-100" disabled>Enviar</button>
                                                        </div>
                                                    </div>
                                                  <hr>
                                                  <h3 style="color: #e31e24;" class="text-center">Compuesto por Código CAS</h3>
                                                    <div class="row">
                                                        <div class="col-5">
                                                            <label for="etiqueta">Código CAS:</label>
                                                            <input class="form-control" id="cas_compuesto_carcasa" type="text" maxlength="25" pattern="[0-9]+-[0-9]+-[0-9]+">
                                                        </div>
                                                        <div class="col-5">
                                                            <label for="etiqueta">Nombre:</label>
                                                            <input class="form-control" id="nombre_compuesto_carcasa_cas" type="text" maxlength="25">
                                                        </div>
                                                        <div class="col-2 d-flex justify-content-center align-items-end">
                                                            <button id="guardar_datos_cas_carcasa" class="no-submit btn btn-danger w-100" disabled>Enviar</button>
                                                        </div>
                                                    </div>
                                                </div>
                                              </div>
                                            </div>
                                        </div>                    
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-12">
                                <div class="row">
                                    <div class="col-6 d-flex flex-column">
                                        <label for="cp_liquido_carcasa">Cp Prom. Líquido:</label>
                                        <div class="input-group mb-2">
                                            <input style="width: 60% !important;" class="form-control" type="number" step="0.0001" max="999999.9999" name="cp_liquido_carcasa" min="0.0001" id="cp_liquido_carcasa" 
                                            {% if not previo.cp_tubo %}disabled{% endif %} value="{{previo.cp_liquido_carcasa}}">
                                            <select style="width: 40% !important;" class="form-select" name="unidad_cp" id="unidad_cp">
                                                {% for unidad in unidades_cp %}
                                                <option value="{{unidad.pk}}" {% if previo.unidad_cp == unidad.pk|slugify %}selected{%endif%}>{{unidad}}</option>
                                                {% endfor %}
                                            </select>
                                        </div>  
                                    </div>
                                    <div class="col-6 d-flex flex-column">
                                        <label for="cp_gas_carcasa">Cp Prom. Gas:</label>
                                        <div class="input-group mb-2">
                                            <input style="width: 60% !important;" class="form-control" type="number" step="0.0001" max="999999.9999" name="cp_gas_carcasa" min="0.0001" id="cp_gas_carcasa" 
                                            {% if not previo.cp_tubo %}disabled{% endif %} value="{{previo.cp_gas_carcasa}}">
                                            <select style="width: 40% !important;" class="form-select" name="unidad_cp" id="unidad_cp" disabled>
                                                <option value="">J/KgK</option>
                                            </select>
                                        </div>  
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="sat_carcasa" class="col-12" hidden>
                        <div class="row">
                            <div class="col-6 d-flex flex-column">
                                <label for="tsat_carcasa">Temp. Saturación:</label>
                                
                                <div class="input-group mb-3">
                                    <input style="width: 60% !important;" step="0.01" value="{{previo.tsat_carcasa}}" type="number" name="tsat_carcasa" id="tsat_carcasa" class="form-control">
                                    <select style="width: 40% !important;" class="form-select" name="unidad_temperaturas" id="unidad_temperaturas" disabled>
                                        {% if previo.unidad_temperaturas %}
                                        {% for unidad in unidades_temperaturas %}
                                        {% if unidad.pk|slugify == previo.unidad_temperaturas %}
                                        <option>{{unidad}}</option>
                                        {%endif%}
                                        {% endfor %}
                                        {% else %}
                                        <option value="1">°C</option>
                                        {%endif%}
                                    </select>
                                </div>
                            </div>
                            <div class="col-6 d-flex flex-column">
                                <label for="hvap_carcasa">Entalpía de Vaporización:</label>
                                <div class="input-group mb-3">
                                    <input style="width: 60% !important;" value="{{previo.hvap_carcasa}}" type="number" name="hvap_carcasa" id="hvap_carcasa" class="form-control">
                                    <select style="width: 40% !important;" class="form-select" name="unidad_hvap" id="unidad_hvap" min="0.01" step="0.01" disabled>
                                        {% if previo.unidad_hvap %}
                                        {% for unidad in unidades_hvap %}
                                        {% if unidad.pk|slugify == previo.unidad_hvap %}
                                        <option>{{unidad}}</option>
                                        {%endif%}
                                        {% endfor %}
                                        {% else %}
                                        <option value="1">J/Kg</option>
                                        {%endif%}
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-6">
                        <label class="form-label" for="caida_presion_max_carcasa">Caída de Presión Máxima:</label>
                        <div class="input-group mb-3">
                            <input value="{{previo.caida_presion_max_carcasa}}" style="width: 60% !important;" class="form-control" type="number" name="caida_presion_max_carcasa" id="caida_presion_max_carcasa" step="0.01" max="99999999.99" required>
                            <select style="width: 40% !important;" class="form-select" name="unidad_presiones" id="unidad_presiones" disabled>
                                {% if previo.unidad_presiones %}
                                {% for unidad in unidades_presion %}
                                {% if unidad.pk|slugify == previo.unidad_presiones %}
                                <option>{{unidad}}</option>
                                {%endif%}
                                {% endfor %}
                                {% else %}
                                <option value="1">bar</option>
                                {%endif%}
                            </select>
                        </div>
                    </div>

                    <div class="col-6">
                        <label class="form-label" for="caida_presion_min_carcasa">Caída de Presión Mínima:</label>
                        <div class="input-group mb-3">
                            <input value="{{previo.caida_presion_min_carcasa}}" style="width: 60% !important;" class="form-control" type="number" name="caida_presion_min_carcasa" id="caida_presion_min_carcasa" step="0.01" max="99999999.99" required>
                            <select style="width: 40% !important;" class="form-select" name="unidad_presiones" id="unidad_presiones" disabled>
                                {% if previo.unidad_presiones %}
                                {% for unidad in unidades_presion %}
                                {% if unidad.pk|slugify == previo.unidad_presiones %}
                                <option>{{unidad}}</option>
                                {%endif%}
                                {% endfor %}
                                {% else %}
                                <option value="1">bar</option>
                                {%endif%}
                            </select>
                        </div>
                    </div>

                    <div class="col-12 mb-2">
                        <label class="form-label" for="fouling_carcasa">Fouling:</label>

                        <div class="input-group">
                            <input min="0.00000001" max="999.99999999" value="{{previo.fouling_carcasa}}" style="width: 60% !important;" class="form-control" type="number" name="fouling_carcasa" id="fouling_carcasa" step="0.00000001" required>
                            <select style="width: 40% !important;" class="form-select" name="unidad_fouling" id="unidad_fouling">
                                {% for unidad in unidades_ensuciamiento %}
                                <option value="{{unidad.pk|slugify}}" {% if previo.unidad_ensuciamiento == unidad.pk|slugify %}selected{%endif%}>{{unidad.simbolo}}</option>                                
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="col-6">
                        <label class="form-label" for="conexiones_entrada_carcasa">Conexiones de Entrada Tubo Ex.:</label>
                        <input value="{{previo.conexiones_entrada_carcasa}}" class="form-control" type="text" maxlength="50" name="conexiones_entrada_carcasa" id="conexiones_entrada_carcasa">
                    </div>

                    <div class="col-6">
                        <label class="form-label" for="conexiones_salida_carcasa">Conexiones de Salida Tubo Ex.:</label>
                        <input value="{{previo.conexiones_salida_tubo}}" class="form-control" type="text" maxlength="50" name="conexiones_salida_carcasa" id="conexiones_salida_carcasa">
                    </div>

                    <div class="col-6">Arreglos en Serie Externo:</label>
                        <input value="{{previo.arreglo_serie_ex}}" step="1" min="1" class="form-control" type="number" maxlength="50" name="arreglo_serie_ex" id="arreglo_serie_ex">
                    </div>
                    
                    <div class="col-6">Arreglos en Paralelo Externo:</label>
                        <input value="{{previo.arreglo_paralelo_ex}}" step="1" min="1" class="form-control" type="number" maxlength="50" name="arreglo_paralelo_ex" id="arreglo_paralelo_ex">
                    </div>
                </div>
            </div>

            <div class="col-6">
                <h4 class="text-center mb-3">Tubo Interno</h4>
                <div class="row">
                    <div class="col-6">
                        <label class="form-label" for="cambio_fase_tubo">Cambio de Fase:</label>
                        <div class="input-group mb-3">
                            <select disabled class="form-select" name="cambio_fase_tubo" id="cambio_fase_tubo">
                                <option  value="-">-</option>
                                <option value="S" {% if previo.cambio_fase_tubo == 'S' %}selected{%endif%}>Sin Cambio de Fase</option>
                                <option value="P" {% if previo.cambio_fase_tubo == 'P' %}selected{%endif%}>Cambio de Fase Parcial</option>
                                <option value="T" {% if previo.cambio_fase_tubo == 'T' %}selected{%endif%}>Cambio de Fase Total</option>                            
                            </select>
                        </div>
                    </div>

                    <div class="col-6">
                        <label class="form-label" for="flujo_tubo">Flujo Másico:</label>
                        <div class="input-group mb-3">
                            <input disabled min="0.01" value="{{previo.flujo_tubo}}" style="width: 60% !important;" class="form-control" type="number" name="flujo_tubo" id="flujo_tubo" step="0.01" max="99999999.99" required>
                            <select style="width: 40% !important;" class="form-select" name="unidad_flujos" id="unidad_flujos" disabled>
                                {% if previo.unidad_flujos %}
                                {% for unidad in unidades_flujo %}
                                {% if unidad.pk|slugify == previo.unidad_flujos %}
                                <option>{{unidad}}</option>
                                {%endif%}
                                {% endfor %}
                                {% else %}
                                <option value="1">Kg/h</option>
                                {%endif%}
                            </select>
                        </div>
                    </div>

                    <div class="col-6">
                        <label class="form-label" for="flujo_vapor_in_tubo">Flujo de Vapor Entrada:</label>
                        <div class="input-group mb-3">
                            <input value="{{previo.flujo_vapor_in_tubo}}" style="width: 60% !important;" class="form-control" type="number" name="flujo_vapor_in_tubo" id="flujo_vapor_in_tubo" step="0.01" max="99999999.99" required>
                            <select style="width: 40% !important;" class="form-select" name="unidad_flujos" id="unidad_flujos" disabled>
                                {% if previo.unidad_flujos %}
                                {% for unidad in unidades_flujo %}
                                {% if unidad.pk|slugify == previo.unidad_flujos %}
                                <option>{{unidad}}</option>
                                {%endif%}
                                {% endfor %}
                                {% else %}
                                <option value="1">Kg/h</option>
                                {%endif%}
                            </select>
                        </div>
                    </div>

                    <div class="col-6">
                        <label class="form-label" for="flujo_vapor_out_tubo">Flujo de Vapor Salida:</label>
                        <div class="input-group mb-3">
                            <input value="{{previo.flujo_vapor_out_tubo}}" style="width: 60% !important;" class="form-control" type="number" name="flujo_vapor_out_tubo" id="flujo_vapor_out_tubo" step="0.01" max="99999999.99" required>
                            <select style="width: 40% !important;" class="form-select" name="unidad_flujos" id="unidad_flujos" disabled>
                                {% if previo.unidad_flujos %}
                                {% for unidad in unidades_flujo %}
                                {% if unidad.pk|slugify == previo.unidad_flujos %}
                                <option>{{unidad}}</option>
                                {%endif%}
                                {% endfor %}
                                {% else %}
                                <option value="1">Kg/h</option>
                                {%endif%}
                            </select>
                        </div>
                    </div>

                    <div class="col-6">
                        <label class="form-label" for="flujo_liquido_in_tubo">Flujo Líquido Entrada:</label>
                        <div class="input-group mb-3">
                            <input value="{{previo.flujo_liquido_in_tubo}}" style="width: 60% !important;" class="form-control" type="number" name="flujo_liquido_in_tubo" id="flujo_liquido_in_tubo" step="0.01" max="99999999.99" required>
                            <select style="width: 40% !important;" class="form-select" name="unidad_flujos" id="unidad_flujos" disabled>
                                {% if previo.unidad_flujos %}
                                {% for unidad in unidades_flujo %}
                                {% if unidad.pk|slugify == previo.unidad_flujos %}
                                <option>{{unidad}}</option>
                                {%endif%}
                                {% endfor %}
                                {% else %}
                                <option value="1">Kg/h</option>
                                {%endif%}
                            </select>
                        </div>
                    </div>

                    <div class="col-6">
                        <label class="form-label" for="flujo_liquido_out_tubo">Flujo Líquido Salida:</label>
                        <div class="input-group mb-3">
                            <input value="{{previo.flujo_liquido_out_tubo}}" style="width: 60% !important;" class="form-control" type="number" name="flujo_liquido_out_tubo" id="flujo_liquido_out_tubo" step="0.01" max="99999999.99" required>
                            <select style="width: 40% !important;" class="form-select" name="unidad_flujos" id="unidad_flujos" disabled>
                                {% if previo.unidad_flujos %}
                                {% for unidad in unidades_flujo %}
                                {% if unidad.pk|slugify == previo.unidad_flujos %}
                                <option>{{unidad}}</option>
                                {%endif%}
                                {% endfor %}
                                {% else %}
                                <option value="1">Kg/h</option>
                                {%endif%}
                            </select>
                        </div>
                    </div>

                    <div class="col-12">
                        <label class="form-label" for="presion_entrada_tubo">Presión Entrada:</label>
                        <div class="input-group mb-3">
                            <input value="{{previo.presion_entrada_tubo}}" style="width: 80% !important;" class="form-control" type="number" name="presion_entrada_tubo" id="presion_entrada_tubo" step="0.01" max="99999999.99" required>
                            <select style="width: 20% !important;" class="form-select" name="unidad_presiones" id="unidad_presiones" disabled>
                                {% if previo.unidad_presiones %}
                                {% for unidad in unidades_presion %}
                                {% if unidad.pk|slugify == previo.unidad_presiones %}
                                <option>{{unidad}}</option>
                                {%endif%}
                                {% endfor %}
                                {% else %}
                                <option value="1">bar</option>
                                {%endif%}
                            </select>
                        </div>
                    </div>

                    <div class="col-6">
                        <label class="form-label" for="temp_in_tubo">Temperatura Entrada:</label>
                        <div class="input-group mb-3">
                            <input value="{{previo.temp_in_tubo}}" style="width: 60% !important;" class="form-control" type="number" name="temp_in_tubo" id="temp_in_tubo" step="0.01" max="99999.99" required>
                            <select style="width: 40% !important;" class="form-select" name="unidad_temperaturas" id="unidad_temperaturas" disabled>
                                {% if previo.unidad_temperaturas %}
                                {% for unidad in unidades_temperaturas %}
                                {% if unidad.pk|slugify == previo.unidad_temperaturas %}
                                <option>{{unidad}}</option>
                                {%endif%}
                                {% endfor %}
                                {% else %}
                                <option value="1">°C</option>
                                {%endif%}
                            </select>
                        </div>
                    </div>
                    
                    <div class="col-6">
                        <label class="form-label" for="temp_out_tubo">Temperatura Salida:</label>
                        <div class="input-group mb-3">
                            <input value="{{previo.temp_out_tubo}}" style="width: 60% !important;" class="form-control" type="number" name="temp_out_tubo" id="temp_out_tubo" step="0.01" max="99999.99" required>
                            <select style="width: 40% !important;" class="form-select" name="unidad_temperaturas" id="unidad_temperaturas" disabled>
                                {% if previo.unidad_temperaturas %}
                                {% for unidad in unidades_temperaturas %}
                                {% if unidad.pk|slugify == previo.unidad_temperaturas %}
                                <option>{{unidad}}</option>
                                {%endif%}
                                {% endfor %}
                                {% else %}
                                <option value="1">°C</option>
                                {%endif%}
                            </select>
                        </div>
                    </div>

                    <div class="col-12 d-flex justify-content-center mb-2">
                        <div style="width: 50%;">
                            <label for="tipo_cp_tubo">Cálculo del Cp:</label>
                            <select class="form-select" name="tipo_cp_tubo" id="tipo_cp_tubo">
                                <option value="A" {% if previo.tipo_cp_tubo == 'A' %} selected {% endif %}>Automático</option>
                                <option value="M" {% if previo.tipo_cp_tubo == 'M' %} selected {% endif %}>Manual</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="row">
                            <div class="col-12">
                                <label class="form-label" for="fluido_tubo">Fluido:</label>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-12 mb-2">
                                <div class="row">
                                    <div class="col-8 d-flex flex-column">    
                                        <select class="form-select" name="fluido_tubo" id="fluido_tubo">
                                            {% for fluido in fluidos %}
                                            <option value="{{fluido.pk}}" {% if previo.fluido_tubo == fluido.pk|slugify %}selected{% endif %}>{{fluido}}</option>
                                            {% endfor %}
                                            {% if previo.fluido_tubo_etiqueta %}
                                            <option value="{{previo.fluido_tubo}}" selected>{{previo.fluido_tubo_etiqueta}}</option>
                                            {%endif%}
                                        </select>
                                    </div>
                            
                                    <div class="col-4 d-flex justify-content-center align-items-start">
                                        <button data-bs-toggle="modal" data-bs-target="#condiciones_diseno_fluido_tubo" class="btn btn-danger no-submit w-100">+</button>
                                        <div class="modal fade" id="condiciones_diseno_fluido_tubo" tabindex="-1" aria-labelledby="condiciones_diseno_fluido_tuboLabel" aria-hidden="true">
                                            <div class="modal-dialog modal-lg modal-dialog-centered">
                                              <div class="modal-content">
                                                <div class="modal-header">
                                                  <h5 class="modal-title">Registrar Fluido de Tubo</h5>
                                                  <button id="condiciones_diseno_fluido_tuboClose" type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <h3 style="color: #e31e24;" class="text-center">Compuesto por Cp en Ficha</h3>
                                                    <div class="row">
                                                        <div class="col-5">
                                                            <label for="etiqueta">Nombre del Compuesto:</label>
                                                            <input class="form-control" id="nombre_compuesto_tubo" type="text" maxlength="25">
                                                        </div>
                                                        <div class="col-5">
                                                            <label for="etiqueta">Cp del Compuesto:</label>
                                                            <input class="form-control" id="cp_compuesto_tubo" type="number" step="0.0001">
                                                        </div>
                                                        <div class="col-2 d-flex justify-content-center align-items-end">
                                                            <button id="enviar_compuesto_tubo_ficha" class="no-submit btn btn-danger w-100" disabled>Enviar</button>
                                                        </div>
                                                    </div>
                                                  <hr>
                                                  <h3 style="color: #e31e24;" class="text-center">Compuesto por Código CAS</h3>
                                                    <div class="row">
                                                        <div class="col-5">
                                                            <label for="etiqueta">Código CAS:</label>
                                                            <input class="form-control" id="cas_compuesto_tubo" type="text" maxlength="25" pattern="[0-9]+-[0-9]+-[0-9]+">
                                                        </div>
                                                        <div class="col-5">
                                                            <label for="etiqueta">Nombre:</label>
                                                            <input class="form-control" id="nombre_compuesto_tubo_cas" type="text" maxlength="25">
                                                        </div>
                                                        <div class="col-2 d-flex justify-content-center align-items-end">
                                                            <button id="guardar_datos_cas_tubo" class="no-submit btn btn-danger w-100" disabled>Enviar</button>
                                                        </div>
                                                    </div>
                                                </div>
                                              </div>
                                            </div>
                                        </div>                    
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-12">
                                <div class="row">
                                    <div class="col-6 d-flex flex-column">
                                        <label for="cp_liquido_tubo">Cp Prom. Líquido:</label>
                                        <div class="input-group mb-2">
                                            <input style="width: 60% !important;" class="form-control" type="number" step="0.0001" max="999999.9999" name="cp_liquido_tubo" min="0.0001" id="cp_liquido_tubo" 
                                            {% if not previo.cp_tubo %}disabled{% endif %} value="{{previo.cp_liquido_tubo}}">
                                            <select style="width: 40% !important;" class="form-select" name="unidad_cp" id="unidad_cp" disabled>
                                                <option value="{{unidad.pk|slugify}}">J/KgK</option>
                                            </select>
                                        </div>  
                                    </div>
                                    <div class="col-6 d-flex flex-column">
                                        <label for="cp_gas_tubo">Cp Prom. Gas:</label>
                                        <div class="input-group mb-2">
                                            <input style="width: 60% !important;" class="form-control" type="number" step="0.0001" max="999999.9999" name="cp_gas_tubo" min="0.0001" id="cp_gas_tubo" 
                                            {% if not previo.cp_tubo %}disabled{% endif %} value="{{previo.cp_gas_tubo}}">
                                            <select style="width: 40% !important;" class="form-select" name="unidad_cp" id="unidad_cp" disabled>
                                                <option value="">J/KgK</option>
                                            </select>
                                        </div>  
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="sat_tubo" class="col-12" hidden>
                        <div class="row">
                            <div class="col-6 d-flex flex-column">
                                <label for="tsat_tubo">Temp. Saturación:</label>
                                
                                <div class="input-group mb-3">
                                    <input style="width: 60% !important;" step="0.01" value="{{previo.tsat_tubo}}" type="number" name="tsat_tubo" id="tsat_tubo" class="form-control">
                                    <select style="width: 40% !important;" class="form-select" name="unidad_temperaturas" id="unidad_temperaturas" disabled>
                                        {% if previo.unidad_temperaturas %}
                                        {% for unidad in unidades_temperaturas %}
                                        {% if unidad.pk|slugify == previo.unidad_temperaturas %}
                                        <option>{{unidad}}</option>
                                        {%endif%}
                                        {% endfor %}
                                        {% else %}
                                        <option value="1">°C</option>
                                        {%endif%}
                                    </select>
                                </div>
                            </div>

                            <div class="col-6 d-flex flex-column">
                                <label for="hvap_tubo">Entalpía de Vaporización:</label>
                                <div class="input-group mb-3">
                                    <input style="width: 60% !important;" value="{{previo.hvap_tubo}}" type="number" name="hvap_tubo" id="hvap_tubo" min="0.01" step="0.01" class="form-control">
                                    <select style="width: 40% !important;" class="form-select" name="unidad_hvap" id="unidad_hvap" disabled>
                                        {% if previo.unidad_hvap %}
                                        {% for unidad in unidades_hvap %}
                                        {% if unidad.pk|slugify == previo.unidad_hvap %}
                                        <option>{{unidad}}</option>
                                        {%endif%}
                                        {% endfor %}
                                        {% else %}
                                        <option value="1">J/Kg</option>
                                        {%endif%}
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-6">
                        <label class="form-label" for="caida_presion_max_tubo">Caída de Presión Máxima:</label>
                        <div class="input-group mb-3">
                            <input value="{{previo.caida_presion_max_tubo}}" style="width: 60% !important;" class="form-control" type="number" name="caida_presion_max_tubo" id="caida_presion_max_tubo" step="0.01" max="99999999.99" required>
                            <select style="width: 40% !important;" class="form-select" name="unidad_presiones" id="unidad_presiones" disabled>
                                {% if previo.unidad_presiones %}
                                {% for unidad in unidades_presion %}
                                {% if unidad.pk|slugify == previo.unidad_presiones %}
                                <option>{{unidad}}</option>
                                {%endif%}
                                {% endfor %}
                                {% else %}
                                <option value="1">bar</option>
                                {%endif%}
                            </select>
                        </div>
                    </div>

                    <div class="col-6">
                        <label class="form-label" for="caida_presion_min_tubo">Caída de Presión Mínima:</label>
                        <div class="input-group mb-3">
                            <input value="{{previo.caida_presion_min_tubo}}" style="width: 60% !important;" class="form-control" type="number" name="caida_presion_min_tubo" id="caida_presion_min_tubo" step="0.01" max="99999999.99" required>
                            <select style="width: 40% !important;" class="form-select" name="unidad_presiones" id="unidad_presiones" disabled>
                                {% if previo.unidad_presiones %}
                                {% for unidad in unidades_presion %}
                                {% if unidad.pk|slugify == previo.unidad_presiones %}
                                <option>{{unidad}}</option>
                                {%endif%}
                                {% endfor %}
                                {% else %}
                                <option value="1">bar</option>
                                {%endif%}
                            </select>
                        </div>
                    </div>

                    <div class="col-12 mb-2">
                        <label class="form-label" for="fouling_tubo">Fouling:</label>
                        <div class="input-group">
                            <input min="0.00000001" max="999.99999999" value="{{previo.fouling_tubo}}" style="width: 60% !important;" class="form-control" type="number" name="fouling_tubo" id="fouling_tubo" step="0.00000001" required>
                            <select style="width: 40% !important;" class="form-select" name="unidad_fouling" id="unidad_fouling" disabled>
                                {% if previo.unidad_fouling %}
                                {% for unidad in unidades_ensuciamiento %}
                                {% if unidad.pk|slugify == previo.unidad_fouling %}
                                <option>{{unidad}}</option>
                                {%endif%}
                                {% endfor %}
                                {% else %}
                                <option value="1">m²K/W</option>
                                {%endif%}
                            </select>
                        </div>
                    </div>

                    <div class="col-6">
                        <label class="form-label" for="conexiones_entrada_tubo">Conexiones de Entrada Tubo In.:</label>
                        <input value="{{previo.conexiones_entrada_tubo}}" class="form-control" type="text" maxlength="50" name="conexiones_entrada_tubo" id="conexiones_entrada_tubo">
                    </div>

                    <div class="col-6">
                        <label class="form-label" for="conexiones_salida_tubo">Conexiones de Salida Tubo In.:</label>
                        <input value="{{previo.conexiones_salida_tubo}}" class="form-control" type="text" maxlength="50" name="conexiones_salida_tubo" id="conexiones_salida_tubo">
                    </div>

                    <div class="col-6">Arreglos en Serie Interno:</label>
                        <input value="{{previo.arreglo_serie_in}}" step="1" min="1" class="form-control" type="number" maxlength="50" name="arreglo_serie_in" id="arreglo_serie_in">
                    </div>
                    
                    <div class="col-6">Arreglos en Paralelo Interno:</label>
                        <input value="{{previo.arreglo_paralelo_in}}" step="1" min="1" class="form-control" type="number" maxlength="50" name="arreglo_paralelo_in" id="arreglo_paralelo_in">
                    </div>
                </div>
            </div>
        </div>
    
        <hr>

        <div class="row g-3">
            <div class="col-12">
                <h5 class="text-center" style="color: #e31e24;">Parámetros de Diseño</h5>
            </div>

            <div class="col-12">    
                <div class="row">                    
                    <div class="col-3">
                        <label class="form-label" for="calor">Calor:</label>
                        <div class="input-group mb-3">
                            <input value="{{previo.calor}}" style="width: 60% !important;" class="form-control" type="number" name="calor" id="calor" max="999999999.999" step="0.001" required>
                            <select style="width: 40% !important;" class="form-select" name="unidad_calor" id="unidad_calor">
                                {% for unidad in unidades_q %}
                                <option value="{{unidad.pk|slugify}}" {% if previo.unidad_ensuciamiento == unidad.pk|slugify %}selected{%endif%}>{{unidad.simbolo}}</option>                                
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="col-3">
                        <label class="form-label" for="area">Área:</label>
                        <div class="input-group mb-3">
                            <input value="{{previo.area}}" style="width: 60% !important;" class="form-control" type="number" name="area" id="area" step="0.01" min="0.01" required>
                            <select style="width: 40% !important;" class="form-select" name="unidad_area" id="unidad_area">
                                {% for unidad in unidades_area %}
                                <option value="{{unidad.pk|slugify}}" {% if intercambiador.area_unidad == unidad.pk|slugify %}selected{%endif%}>{{unidad.simbolo}}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="col-3">
                        <label class="form-label" for="no_tubos">No. Tubos:</label>
                        <input value="{{previo.no_tubos}}" class="form-control" type="number" name="no_tubos" id="no_tubos" step="1" required>
                    </div>

                    <div class="col-3">
                        <label class="form-label" for="longitud_tubos">Longitud Tubos:</label>
                        <div class="input-group mb-3">
                            <input value="{{previo.longitud_tubos}}" style="width: 60% !important;" class="form-control" type="number" name="longitud_tubos" id="longitud_tubos" min="0.01" max="999999.99" step="0.01" required>
                            <select style="width: 40% !important;" class="form-select" name="longitud_tubos_unidad" id="longitud_tubos_unidad">
                                {% for unidad in unidades_longitud %}
                                <option value="{{unidad.pk|slugify}}" {% if previo.longitud_tubos_unidad == unidad.pk|slugify %}selected{%endif%}>{{unidad.simbolo}}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="col-3">
                        <label class="form-label" for="od_in">OD Tubo Interno:</label>
                        <div class="input-group mb-3">
                            <input value="{{previo.od_in}}" style="width: 60% !important;" class="form-control" type="number" name="od_in" id="od_in" step="0.01" min="0.01" max="999999.99" required>
                            <select style="width: 40% !important;" class="form-select" name="unidad_diametros" id="unidad_diametros">
                                {% for unidad in unidades_longitud %}
                                <option value="{{unidad.pk|slugify}}" {% if previo.unidad_diametros == unidad.pk|slugify %}selected{%endif%}>{{unidad.simbolo}}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="col-3">
                        <label class="form-label" for="od_ex">OD Tubo Externo:</label>
                        <div class="input-group mb-3">
                            <input value="{{previo.od_ex}}" style="width: 60% !important;" class="form-control" type="number" name="od_ex" id="od_ex" step="0.01" min="0.01" max="999999.99" required>
                            <select style="width: 40% !important;" class="form-select" name="unidad_diametros" id="unidad_diametros" disabled>
                                {% if previo.unidad_diametros %}
                                {% for unidad in unidades_longitud %}
                                {% if unidad.pk|slugify == previo.unidad_diametros %}
                                <option>{{unidad}}</option>
                                {%endif%}
                                {% endfor %}
                                {% else %}
                                <option value="1">m</option>
                                {%endif%}
                            </select>
                        </div>
                    </div>

                    <div class="col-3">
                        <label class="form-label" for="u">U:</label>
                        <div class="input-group">
                            <input style="width: 60% !important;" value="{{previo.u}}" max="99999999.999" step="0.001" min="0.001" class="form-control" type="number" name="u" id="u">
                            <select style="width: 40% !important;" class="form-select" name="unidad_u" id="unidad_u">
                                {% for unidad in unidades_u %}
                                <option value="{{unidad.pk|slugify}}" {% if previo.unidad_u == unidad.pk|slugify %}selected{%endif%}>{{unidad}}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="col-3">
                        <label class="form-label" for="ensuciamiento">Ensuciamiento:</label>
                        <div class="input-group">
                            <input style="width: 60% !important;" value="{{previo.ensuciamiento}}" max="999.999999999" step="0.000000001" min="0" class="form-control" type="number" name="ensuciamiento" id="ensuciamiento">
                            <select style="width: 40% !important;" class="form-select" name="unidad_fouling" id="unidad_fouling" disabled>
                                {% if previo.unidad_fouling %}
                                {% for unidad in unidades_ensuciamiento %}
                                {% if unidad.pk|slugify == previo.unidad_fouling %}
                                <option>{{unidad}}</option>
                                {%endif%}
                                {% empty %}
                                {% endfor %}
                                {% else %}
                                <option value="1">m²K/W</option>
                                {%endif%}
                            </select>
                        </div>
                    </div>

                    <div class="col-4">
                        <label class="form-label" for="tipo_tubo">Tipo de Tubo:</label>
                        <select name="tipo_tubo" class="form-select" id="tipo_tubo">
                            {% for tipo in tipos %}
                            <option value="{{tipo.pk}}" {% if previo.tipo_tubo == tipo.pk|slugify %}selected{% endif %}>{{tipo}}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="col-4">
                        <label class="form-label" for="material_carcasa">Material Tubo Externo:</label>
                        <input maxlength="50" value="{{previo.material_carcasa}}" class="form-control" type="text" name="material_carcasa" id="material_carcasa">
                    </div>

                    <div class="col-4">
                        <label class="form-label" for="material_tubo">Material Tubo Interno:</label>
                        <input maxlength="50" value="{{previo.material_tubo}}" class="form-control" type="text" name="material_tubo" id="material_tubo">
                    </div>
                </div>
            </div>
        </div>

        <hr>
        
        <div class="d-flex justify-content-center mb-3">
            <button type="submit" class="btn btn-danger" disabled>Registrar Intercambiador</button>
        </div>
    </form>
{% endblock %}

{% block extra_javascript %}
<script>
    {% include 'scripts/ajaxCP.js' %}

    {% include 'scripts/validaciones_flujo.js' %}

    {% include 'scripts/cambio_fase.js' %}
</script>
{% endblock %}