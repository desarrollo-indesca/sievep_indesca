{% extends 'base_consultas.html' %}
{% load static %}

{% block encabezado %}
  <div class="col-md-3 col-lg-2 d-flex justify-content-center align-items-center h-100"><a class="btn d-block btn-secondary" href="{% url 'seleccion_tipo_intercambiador' %}">↶ Regresar</a></div>
  <div class="col-md-6 col-lg-8"><h3 class="text-center" style="color: #e31e24;">Intercambiadores de Calor Tubo/Carcasa</h3></div>
  <div class="col-md-3 col-lg-2 d-flex justify-content-center align-items-center h-100"><a class="btn d-block btn-success" href="{% url 'crear_tubo_carcasa' %}">+ Nuevo</a></div>
{% endblock %}

{% block formulario_filtrado %}
<div class="d-flex flex-column col">
  <label class="form-label" for="tag">Tag:</label>
  <input type="text" name="tag" id="tag" maxlength="20" class="form-control">
</div>
<div class="d-flex flex-column col">
    <label class="form-label" for="servicio">Servicio:</label>
    <input type="text" id="servicio" name="servicio" class="form-control">
</div>
<div class="d-flex flex-column col">
    <label class="form-label" for="complejo">Complejo:</label>
    <select name="complejo" id="complejo" class="form-control">
        <option value="">
            ----------------------------
        </option>
        <option value="1">ANA MARÍA CAMPOS</option>
        <option value="2">HUGO CHÁVEZ</option>
        <option value="3">JOSÉ ANTONIO ANZOÁTEGUI</option>
    </select>
</div>
<div class="d-flex flex-column col">
    <label class="form-label" for="planta">Planta:</label>
    <select name="planta" id="planta" disabled="disabled" class="form-control">
        <option value="">
            ----------------------------
        </option>
    </select>
</div>
{% endblock %}

{% block tabla %}
<thead class="text-center">
  <tr>
    <th scope="col">#</th>
    <th scope="col">Tag</th>
    <th scope="col">Planta</th>
    <th scope="col">Complejo</th>
    <th scope="col">Servicio</th>
    <th scope="col">Evaluaciones</th>
    <th scope="col">Ficha Técnica</th>
  </tr>
</thead>
<tbody class="text-center">
  {% for intercambiador in object_list %}
  <tr>
    {% with generales=intercambiador.intercambiador %}
    <th scope="row">{{forloop.counter}}</th>
    <td>{{generales.tag}}</td>
    <td>{{generales.planta}}</td>
    <td>{{generales.planta.complejo}}</td>
    <td>{{generales.servicio}}</td>
    <td>
      <a class="btn btn-danger" href="{% url 'consulta_evaluaciones_tubo_carcasa' pk=1 %}"><img width="25px" src="{% static 'img/iconos/simulacion.png' %}" alt="Ir a la pantalla de Evaluaciones"></a>
    </td>
    <td>
      {% include 'fichas/intercambiadores/tubo_carcasa.html' %}
      <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#ficha_{{intercambiador.pk}}"><img width="25px" src="{% static 'img/iconos/ficha.png' %}" alt="Mostrar ficha técnica"></a>
    </td>
    {% endwith %}
  </tr>
  {% endfor %}
</tbody>
{% endblock %}

{% block opciones %}
<div>
  <form method="get">
    <button class="btn btn-danger d-inline-flex" style="color: black;"><img src="{% static 'img/iconos/pdf.png' %}" width="20px" alt="Ícono Reporte PDF">&nbsp;Guardar Reporte PDF</button>
    <button class="btn btn-success d-inline-flex" style="color: black;"><img src="{% static 'img/iconos/xlsx.png' %}" width="20px" alt="Ícono Reporte XLSX">&nbsp;Guardar Reporte XLSX</button>
  </form>
</div>
<nav aria-label="Page navigation example">
    <ul class="pagination">
      <li class="page-item">
        <a class="page-link bg-dark text-white" href="#" aria-label="Previous">
          <span aria-hidden="true">&laquo;</span>
        </a>
      </li>
      <li class="page-item"><a class="page-link bg-dark text-white" href="#">1</a></li>
      <li class="page-item"><a class="page-link bg-dark text-white" href="#">2</a></li>
      <li class="page-item"><a class="page-link bg-dark text-white" href="#">3</a></li>
      <li class="page-item">
        <a class="page-link bg-dark text-white" href="#" aria-label="Next">
          <span aria-hidden="true">&raquo;</span>
        </a>
      </li>
    </ul>
</nav>
{% endblock %}

{% block extra_javascript %}
<script>
  let canvas = document.getElementById('grafica_1').getContext('2d');
  let datosGrafica = undefined;

  // $.ajax({
  //     url: `datos_grafica.php?id=<?php echo $_GET['id_pozo']; ?>&fecha_max=${$('#fecha_max').val()}&fecha_min=${$('#fecha_min').val()}`,
  //     method: "GET",
  //     async: false,
  //     success: function(data){
  //         console.log(data);
  //         datosGrafica = JSON.parse(data);
  //     },
  //     error: function(error){
  //         console.log(error);
  //     }
  // });

  $('#grafica').removeAttr('hidden');
  if(chart)
    chart.destroy();

  chart = new Chart(canvas, {
          type: 'line',
          data: {
              datasets: [
                  {
                      label: "Tubo Externo",
                      data: [50, 35],
                      backgroundColor: ['#E31E24']
                  },
                  {
                      label: "Tubo Interno",
                      data: [52, 34],
                      backgroundColor: ['#555']
                  }
              ]
          },
          options: {
              responsive: true,
              plugins: {
                  title: {
                      display: true,
                      text: 'Variación de las Temperaturas',
                      position: 'top'
                  },
                  legend: {
                      display: true
                  }
              }        
          }
  });
</script>
{% endblock %}