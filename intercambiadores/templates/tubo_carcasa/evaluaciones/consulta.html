{% extends 'base_consultas.html' %}
{% load static %}
{% load templatetags %}

{% block encabezado %}
  {% with generales=intercambiador.intercambiador %}
  <div class="col-md-3 col-lg-2 d-flex justify-content-center align-items-center h-100"><a class="btn d-block btn-secondary" href="{% url 'consulta_tubo_carcasa' %}">↶ Regresar</a></div>
  <div class="col-md-6 col-lg-8"><h3 class="text-center" style="color: #e31e24;">Evaluaciones del Intercambiador {{generales.tag}}</h3></div>
  <div class="col-md-3 col-lg-2 d-flex justify-content-center align-items-center h-100">
    <a class="btn d-block btn-success" href="{% url 'crear_evaluacion_tubo_carcasa' pk=intercambiador.pk %}">+ Nueva</a> &nbsp;
  </div>

  <script>
    let chart = null;
    let canvas = null;
    let datosGrafica = null;
  </script>
  {% endwith %}
{% endblock %}

{% block formulario_filtrado %}
  <div class="d-flex flex-column col-2">
    <label class="form-label" for="tag">Desde:</label>
    <input value="{{desde}}" type="datetime-local" class="form-control" name="desde" id="desde">
  </div>
  <div class="d-flex flex-column col-2">
      <label class="form-label" for="empresa">Hasta:</label>
      <input value="{{hasta}}" type="datetime-local" class="form-control" name="hasta" id="hasta">
  </div>
  <div class="d-flex flex-column col-2">
      <label class="form-label" for="condiciones">Condiciones:</label>
      <select name="condiciones" id="condiciones" class="form-control">
        <option value="">
          ----------------------------
        </option>
        <option value="D" {%if condiciones == 'D'%}selected{%endif%}>
          Diseño
        </option>
        <option value="M" {%if condiciones == 'M'%}selected{%endif%}>
          Máximas
        </option>
        <option value="m" {%if condiciones == 'm'%}selected{%endif%}>
          Mínimas                            
        </option>
        <option value="P" {%if condiciones == 'P'%}selected{%endif%}>
          Planta
        </option>
      </select>
  </div>
  <div class="d-flex flex-column col-2">
    <label class="form-label" for="tag">Método:</label>
    <select name="condiciones" id="condiciones" class="form-control">
      <option value="">
        ----------------------------
      </option>
      <option value="E" {%if condiciones == 'E'%}selected{%endif%}>
        Método Eficiencia-NTU
      </option>
      <option value="L" {%if condiciones == 'L'%}selected{%endif%}>
        Método LMTD
      </option>
    </select>
  </div>
  <div class="d-flex flex-column col-4">
    <label class="form-label" for="tag">Nombre:</label>
    <input value="{{nombre}}" name="nombre" type="text" class="form-control">
  </div>
{% endblock %}
  
{% block tabla %}
<thead class="text-center">
  <tr>
    <th scope="col">#</th>
    <th scope="col">Fecha</th>
    <th scope="col">Nombre</th>
    <th scope="col">Condiciones</th>
    <th scope="col">Método</th>
    <th scope="col">Resultados</th>
  </tr>
</thead>
<tbody class="text-center">
  {% if object_list.count %}
  {% include 'tablas/intercambiadores/evaluaciones.html' %}
  {% else %}
  <td colspan="7">No se encontraron evaluaciones con los datos de filtrado proporcionados.</td>
  {% endif %}
</tbody>
{% endblock %}

{% block opciones %}
{% with generales=intercambiador.intercambiador %}
<div>
  <form method="get">
    <button class="btn btn-danger d-inline-flex" style="color: black;"><img src="{% static 'img/iconos/pdf.png' %}" width="20px" alt="Ícono Reporte PDF">&nbsp;Reporte PDF</button>
    <button class="btn btn-success d-inline-flex" style="color: black;"><img src="{% static 'img/iconos/xlsx.png' %}" width="20px" alt="Ícono Reporte XLSX">&nbsp;Reporte XLSX</button>
    <button type="button" class="btn btn-secondary" style="color: black;" data-bs-toggle="modal" data-bs-target="#ficha_{{intercambiador.pk}}"><img width="25px" src="{% static 'img/iconos/ficha.png' %}" alt="Mostrar ficha técnica">&nbsp;Ficha Técnica</button>
    <button type="button" class="btn btn-warning" style="color: black;" data-bs-toggle="modal" data-bs-target="#grafica_historica"><img width="25px" src="{% static 'img/iconos/resultados.png' %}" alt="Mostrar gráfica histórico">&nbsp;Gráfica Histórica</button>
  </form>
  {% include 'fichas/intercambiadores/tubo_carcasa.html' %}
  {% include 'resultados/intercambiadores/historico.html' %}
</div>
{% endwith %}
<footer aria-label="Page navigation example">
  <ul class="pagination">
    <li class="page-item">
      {% if page_obj.has_previous %}
      <a class="page-link bg-dark text-white" href="?{% url_replace page=page_obj.previous_page_number %}" aria-label="Previous">
        <span aria-hidden="true">&laquo;</span>
      </a>
      {% endif %}
    </li>
    <li class="page-item"><a class="page-link bg-dark text-white" href="#">{{ page_obj.number }}</a></li>
    {% if page_obj.has_next %}
    <li class="page-item">
      <a class="page-link bg-dark text-white" href="?{% url_replace page=page_obj.next_page_number %}" aria-label="Next">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
    {% endif %}
  </ul>
</footer>
{% endblock %}

{% block extra_javascript %}
<script>
  $('select').change(() => {
    $('#filtrado').submit();
  });

  $('input[type="datetime-local"]').change(() => {
    $('#filtrado').submit();
  });
</script>
{% endblock %}