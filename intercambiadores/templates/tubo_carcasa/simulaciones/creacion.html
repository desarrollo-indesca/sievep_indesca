{% extends 'base.html' %}
{% load static %}

{% block contenido %}
    <form method="post">
        <div class="row">
            <div class="col-md-3 col-lg-2 d-flex justify-content-center align-items-center h-100"><a class="btn d-block btn-secondary" href="{% url 'consulta_simulaciones_tubo_carcasa' pk=1 %}">↶ Regresar</a></div>
            <div class="col-md-6 col-lg-8"><h3 class="text-center" style="color: #e31e24;">Nueva Simulación para el Intercambiador 180-C</h3></div>
            <div class="col-md-3 col-lg-2 d-flex justify-content-center align-items-center h-100">
                {% include 'fichas/intercambiadores/tubo_carcasa.html' %}
                <button type="button" class="btn btn-danger text-dark" data-bs-toggle="modal" data-bs-target="#ficha_{{x}}"><img width="25px" src="{% static 'img/iconos/ficha.png' %}" alt="Mostrar ficha técnica"> Ficha Técnica</button>
            </div>
        </div>
    
        <hr>
    
        <div class="row">
            <div class="col-4 d-flex flex-column">
                <label for="metodo">Nombre de la Simulación:</label>
                <input type="text" class="form-control" name="nombre">
            </div>

            <div class="col-4 d-flex flex-column">
                <label for="metodo">Método:</label>
                <select required class="form-select" name="metodo" id="metodo">
                    <option value="NTU">Eficiencia-NTU</option>
                    <option value="LMTD">LMTD</option>
                    <option value="DOS">Ambos</option>
                </select>
            </div>
    
            <div class="col-4 d-flex flex-column">
                <label for="metodo">Condiciones:</label>
                <select required class="form-select" name="metodo" id="metodo">
                    <option value="D">De Diseño</option>
                    <option value="M">Máximas</option>
                    <option value="m">Mínimas</option>
                    <option value="P">De Planta</option>
                    <option value="p">De Proceso</option>
                    <option value="O">Otras</option>
                </select>
            </div>
        </div>
    
        <hr>
    
        <div class="row">
            <div class="col-6 border-end bordern-end-dark">
                <h4 class="text-center mb-3">Carcasa</h4>
    
                <div class="row">
                    <div class="col-6 d-flex flex-column">
                        <label for="temp_in_carcasa">Temperatura Entrada (°C):</label>
                        <input class="form-control" type="number" name="temp_in_carcasa" id="temp_in_carcasa" step="0.01" min="-273.15" max="9999.99" required>
                    </div>
                    <div class="col-6">
                        <label for="temp_out_carcasa">Temperatura Salida (°C):</label>
                        <input class="form-control" type="number" name="temp_out_carcasa" id="temp_out_carcasa" step="0.01" min="-273.15" max="9999.99" required>
                    </div>
                    <div class="col-12">
                        <label for="temp_in_carcasa">Flujo Másico (Kg/h):</label>
                        <input class="form-control" type="number" name="temp_in_carcasa" id="temp_in_carcasa" step="0.01" min="-273.15" max="9999.99" required>
                    </div>
                </div>
            </div>
            <div class="col-6">
                <h4 class="text-center mb-3">Tubo</h4>
                <div class="row">
                    <div class="col-6 d-flex flex-column">
                        <label for="temp_in_carcasa">Temperatura Entrada (°C):</label>
                        <input class="form-control" type="number" name="temp_in_carcasa" id="temp_in_carcasa" step="0.01" min="-273.15" max="9999.99" required>
                    </div>
                    <div class="col-6">
                        <label for="temp_out_carcasa">Temperatura Salida (°C):</label>
                        <input class="form-control" type="number" name="temp_out_carcasa" id="temp_out_carcasa" step="0.01" min="-273.15" max="9999.99" required>
                    </div>
                    <div class="col-12">
                        <label for="temp_in_carcasa">Flujo Másico (Kg/h):</label>
                        <input class="form-control" type="number" name="temp_in_carcasa" id="temp_in_carcasa" step="0.01" min="-273.15" max="9999.99" required>
                    </div>
                </div>
            </div>
        </div>
    
        <hr>
        <div class="row p-3">
            <div class="col-6 row border-end g-2">
                <div class="col-12">
                    <h5 class="text-center">Cálculo de Resultados</h5>
                </div>

                <div class="col-4 d-flex flex-column">
                    <label>LMTD:</label>
                    <input id="lmtd" disabled type="text" class="form-control">
                </div>
                <div class="col-4 d-flex flex-column">
                    <label>Área Transf. (m²):</label>
                    <input id="area" disabled type="text" class="form-control">
                </div>
                <div class="col-4 d-flex flex-column">
                    <label>NTU:</label>
                    <input id="ntu" disabled type="text" class="form-control">
                </div>
                <div class="col-4 d-flex flex-column">
                    <label>Efectividad:</label>
                    <input id="efectividad" disabled type="text" class="form-control">
                </div>
                <div class="col-4 d-flex flex-column">
                    <label>U (Kcal/hCm²)</label>
                    <input id="u" disabled type="text" class="form-control">
                </div>
                <div class="col-4 d-flex flex-column">
                    <label>UA (Kcal/hC):</label>
                    <input id="UA" disabled type="text" class="form-control">
                </div>
                <div class="col-4 d-flex flex-column">
                    <label>% Eficiencia:</label>
                    <input id="eficiencia" disabled type="text" class="form-control">
                </div>
                <div class="col-4 d-flex flex-column">
                    <label>Ensuciamiento:</label>
                    <input id="ensuciamiento" disabled type="text" class="form-control">
                </div>
                <div class="col-12 row">
                    <div class="col-4 d-flex justify-content-center align-items-center">
                        <b>Coefic. de Película (Kcal/hm²C)</b>
                    </div>
                    <div class="d-flex flex-column col-4">
                        <label>Interno:</label>
                        <input id="coef_interno" disabled type="text" class="form-control">
                    </div>
                    <div class="d-flex flex-column col-4">
                        <label>Externo:</label>
                        <input id="coef_externo" disabled type="text" class="form-control">
                    </div>  
                </div>          
            </div>
            <div class="col-6">
                <canvas id="grafica_1" style="width: 100%;"></canvas> <!-- Gráfica -->
            </div>     
        </div>
        <hr>
        
        <div class="d-flex justify-content-center">
            <button class="btn btn-danger">Guardar Resultados De La Simulación</button>
        </div>
    </form>
{% endblock %}

{% block extra_javascript %}
<script>
    let chart = null;
    let canvas = document.getElementById('grafica_1').getContext('2d');
    let datosGrafica = undefined;
  
    console.log("a");
  
    // $.ajax({
    //     url: `datos_grafica.php?id=<?php echo $_GET['id_pozo']; ?>&fecha_max=${$('#fecha_max').val()}&fecha_min=${$('#fecha_min').val()}`,
    //     method: "GET",
    //     async: false,
    //     success: function(data){
    //         console.log(data);
    //         datosGrafica = JSON.parse(data);
    //     },
    //     error: function(error){
    //         console.log(error);
    //     }
    // });
  
    $('#grafica_1').removeAttr('hidden');
    if(chart)
      chart.destroy();
  
    chart = new Chart(canvas, {
            type: 'line',
            data: {
                datasets: [
                    {
                        label: "Tubo Externo",
                        data: {
                          Inicial: 50,
                          Final: 35
                        },
                        backgroundColor: ['#E31E24'],
                        borderColor: ['#E31E24']
                    },
                    {
                        label: "Tubo Interno",
                        data: {
                          Inicial: 52,
                          Final: 34
                        },
                        backgroundColor: ['#555'],
                        borderColor: ['#555']
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Variación de las Temperaturas',
                        position: 'top'
                    },
                    legend: {
                        display: true
                    }
                }        
            }
    });
</script>
{% endblock %}