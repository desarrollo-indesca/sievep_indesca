{% extends 'base.html' %}
{% load static %}

{% block contenido %}
    <form method="post">
        <div class="row">
            <div class="col-md-3 col-lg-2 d-flex justify-content-center align-items-center h-100"><a class="btn d-block btn-secondary" href="{% url 'consulta_simulaciones_tubo_carcasa' pk=1 %}">↶ Regresar</a></div>
            <div class="col-md-6 col-lg-8"><h3 class="text-center" style="color: #e31e24;">Nuevo Intercambiador de Tubo/Carcasa</h3></div>
            <div class="col-md-3 col-lg-2 d-flex justify-content-center align-items-center h-100">
                {% include 'fichas/intercambiadores/tubo_carcasa.html' %}
                <button type="button" class="btn btn-danger text-dark" data-bs-toggle="modal" data-bs-target="#ficha_{{x}}"><img width="25px" src="{% static 'img/iconos/ficha.png' %}" alt="Mostrar ficha técnica"> Ficha Técnica</button>
            </div>
        </div>
    
        <hr>
    
        <div class="row">
            <div class="col-12">
                <h5 class="text-center" style="color: #e31e24;">Datos de Identificación</h5>
            </div>

            <div class="col-3 d-flex flex-column">
                <label for="empresa">Empresa:</label>
                <select class="form-select" name="empresa" id="empresa">
                    <option value="1">PEQUIVEN</option>
                    <option value="2">PROPILVEN</option>
                    <option value="3">POLINTER</option>
                </select>
            </div>

            <div class="col-3 d-flex flex-column">
                <label for="complejo">Complejo:</label>
                <select required class="form-select" name="complejo" id="complejo">
                    <option value="1">ANA MARÍA CAMPOS</option>
                    <option value="2">JOSÉ ANTONIO ANZOÁTEGUI</option>
                    <option value="3">HUGO CHÁVEZ</option>
                </select>
            </div>
    
            <div class="col-3 d-flex flex-column">
                <label for="planta">Planta:</label>
                <select required class="form-select" name="planta" id="planta">
                    <option value="1">Olefinas I</option>
                    <option value="2">Olefinas II</option>
                    <option value="3">LGN I</option>
                    <option value="4">LGN II</option>
                    <option value="5">AMONÍACO</option>
                    <option value="6">UREA</option>
                    <option value="7">CLOROSODA</option>
                    <option value="8">SERVICIOS INDUSTRIALES</option>
                    <option value="9">MVC</option>
                    <option value="10">PVC</option>
                </select>
            </div>

            <div class="col-3 d-flex flex-column">
                <label for="tema">Tema:</label>
                <select class="form-select" name="tema" id="tema">
                    <option value="1">AJS</option>
                    <option value="2">BEM</option>
                    <option value="3">AXS</option>
                </select>
            </div>

            <div class="col-3 d-flex flex-column">
                <label for="tag">Tag del Equipo:</label>
                <input type="text" required class="form-control" name="tag" id="tag">
            </div>

            <div class="col-3 d-flex flex-column">
                <label for="servicio">Servicio:</label>
                <input type="text" required class="form-control" name="servicio" id="servicio">
            </div>            

            <div class="col-3 d-flex flex-column">
                <label for="fabricante">Fabricante:</label>
                <input type="text" required class="form-control" name="fabricante" id="fabricante">
            </div>

            <div class="col-3 d-flex flex-column">
                <label for="criticidad">Criticidad:</label>
                <select class="form-select" name="criticidad" id="criticidad">
                    <option value="1">No Crítico</option>
                    <option value="2">Semi Crítico</option>
                    <option value="3">Crítico</option>
                </select>
            </div>
        </div>
    
        <hr>
    
        <div class="row g-3">
            <div class="col-12">
                <h5 class="text-center" style="color: #e31e24;">Datos de Condiciones de Diseño</h5>
            </div>

            <div class="col-6 border-end">
                <h4 class="text-center mb-3">Carcasa</h4>
    
                <div class="row">
                    <div class="col-12 d-flex flex-column">
                        <label for="fluido_carcasa">Fluido:</label>
                        <select class="form-select" name="fluido_carcasa" id="fluido_carcasa">
                            <option value="1">Agua</option>
                            <option value="2">Hidrocarburos</option>
                            <option value="3">Metano</option>
                            <option value="4">Etileno</option>
                            <option value="5">Agua Caliente</option>
                        </select>
                    </div>
                    
                    <div class="col-6">
                        <label for="temp_in_carcasa">Temperatura Entrada (°C):</label>
                        <input class="form-control" type="number" name="temp_in_carcasa" id="temp_in_carcasa" step="0.01" min="-273.15" max="9999.99" required>
                    </div>
                    <div class="col-6">
                        <label for="temp_out_carcasa">Temperatura Salida (°C):</label>
                        <input class="form-control" type="number" name="temp_out_carcasa" id="temp_out_carcasa" step="0.01" min="-273.15" max="9999.99" required>
                    </div>

                    <div class="col-12">
                        <label for="flujo_carcasa">Flujo Másico (Kg/h):</label>
                        <input class="form-control" type="number" name="flujo_carcasa" id="flujo_carcasa" step="0.01" min="-273.15" max="9999.99" required>
                    </div>

                    <div class="col-6">
                        <label for="flujo_vapor_in_carcasa">Flujo de Vapor Entrada (Kg/h):</label>
                        <input class="form-control" type="number" name="flujo_vapor_in_carcasa" id="flujo_vapor_in_carcasa" step="0.01" min="-273.15" max="9999.99" required>
                    </div>
                    <div class="col-6">
                        <label for="flujo_vapor_out_carcasa">Flujo de Vapor Salida (Kg/h):</label>
                        <input class="form-control" type="number" name="flujo_vapor_out_carcasa" id="flujo_vapor_out_carcasa" step="0.01" min="-273.15" max="9999.99" required>
                    </div>

                    <div class="col-6">
                        <label for="flujo_liquido_in_carcasa">Flujo Líquido Entrada (Kg/h):</label>
                        <input class="form-control" type="number" name="flujo_liquido_in_carcasa" id="flujo_liquido_in_carcasa" step="0.01" min="-273.15" max="9999.99" required>
                    </div>
                    <div class="col-6">
                        <label for="flujo_liquido_out_carcasa">Flujo Líquido Salida (Kg/h):</label>
                        <input class="form-control" type="number" name="flujo_liquido_out_carcasa" id="flujo_liquido_out_carcasa" step="0.01" min="-273.15" max="9999.99" required>
                    </div>

                    <div class="col-12">
                        <label for="presion_entrada_carcasa">Presión Entrada (barg):</label>
                        <input class="form-control" type="number" name="presion_entrada_carcasa" id="presion_entrada_carcasa" step="0.01" required>
                    </div>

                    <div class="col-6">
                        <label for="caida_presion_permitida_carcasa">Caída de Presión Permitida (bar):</label>
                        <input class="form-control" type="number" name="caida_presion_permitida_carcasa" id="caida_presion_permitida_carcasa" step="0.01">
                    </div>
                    <div class="col-6">
                        <label for="caida_presion_diseno_carcasa">Caída de Presión Diseño (bar):</label>
                        <input class="form-control" type="number" name="caida_presion_diseno_carcasa" id="caida_presion_diseno_carcasa" step="0.01">
                    </div>

                    <div class="col-12">
                        <label for="fouling_carcasa">Fouling (m²C/W):</label>
                        <input class="form-control" type="number" name="fouling_carcasa" id="fouling_carcasa" step="0.00000001" required>
                    </div>

                    <div class="col-6">
                        <label for="conexiones_entrada_carcasa">Conexiones de Entrada:</label>
                        <input class="form-control" type="text" name="conexiones_entrada_carcasa" id="conexiones_entrada_carcasa" step="0.01">
                    </div>
                    <div class="col-6">
                        <label for="conexiones_salida_carcasa">Conexiones de Salida:</label>
                        <input class="form-control" type="text" name="conexiones_salida_carcasa" id="conexiones_salida_carcasa" step="0.01">
                    </div>
                </div>
            </div>

            <div class="col-6">
                <h4 class="text-center mb-3">Tubo</h4>
                <div class="row">
                    <div class="col-12 d-flex flex-column">
                        <label for="fluido_tubo">Fluido:</label>
                        <select class="form-select" name="fluido_tubo" id="fluido_tubo">
                            <option value="1">Agua</option>
                            <option value="2">Hidrocarburos</option>
                            <option value="3">Metano</option>
                            <option value="4">Etileno</option>
                            <option value="5">Agua Caliente</option>
                        </select>
                    </div>
                    
                    <div class="col-6">
                        <label for="temp_in_tubo">Temperatura Entrada (°C):</label>
                        <input class="form-control" type="number" name="temp_in_tubo" id="temp_in_tubo" step="0.01" min="-273.15" max="9999.99" required>
                    </div>
                    <div class="col-6">
                        <label for="temp_out_tubo">Temperatura Salida (°C):</label>
                        <input class="form-control" type="number" name="temp_out_tubo" id="temp_out_tubo" step="0.01" min="-273.15" max="9999.99" required>
                    </div>

                    <div class="col-12">
                        <label for="flujo_tubo">Flujo Másico (Kg/h):</label>
                        <input class="form-control" type="number" name="flujo_tubo" id="flujo_tubo" step="0.01" min="-273.15" max="9999.99" required>
                    </div>

                    <div class="col-6">
                        <label for="flujo_vapor_in_tubo">Flujo de Vapor Entrada (Kg/h):</label>
                        <input class="form-control" type="number" name="flujo_vapor_in_tubo" id="flujo_vapor_in_tubo" step="0.01" min="-273.15" max="9999.99" required>
                    </div>
                    <div class="col-6">
                        <label for="flujo_vapor_out_tubo">Flujo de Vapor Salida (Kg/h):</label>
                        <input class="form-control" type="number" name="flujo_vapor_out_tubo" id="flujo_vapor_out_tubo" step="0.01" min="-273.15" max="9999.99" required>
                    </div>

                    <div class="col-6">
                        <label for="flujo_liquido_in_tubo">Flujo Líquido Entrada (Kg/h):</label>
                        <input class="form-control" type="number" name="flujo_liquido_in_tubo" id="flujo_liquido_in_tubo" step="0.01" min="-273.15" max="9999.99" required>
                    </div>
                    <div class="col-6">
                        <label for="flujo_liquido_out_tubo">Flujo Líquido Salida (Kg/h):</label>
                        <input class="form-control" type="number" name="flujo_liquido_out_tubo" id="flujo_liquido_out_tubo" step="0.01" min="-273.15" max="9999.99" required>
                    </div>

                    <div class="col-12">
                        <label for="presion_entrada_tubo">Presión Entrada (barg):</label>
                        <input class="form-control" type="number" name="presion_entrada_tubo" id="presion_entrada_tubo" step="0.01" required>
                    </div>

                    <div class="col-6">
                        <label for="caida_presion_permitida_tubo">Caída de Presión Permitida (bar):</label>
                        <input class="form-control" type="number" name="caida_presion_permitida_tubo" id="caida_presion_permitida_tubo" step="0.01">
                    </div>
                    <div class="col-6">
                        <label for="caida_presion_diseno_tubo">Caída de Presión Diseño (bar):</label>
                        <input class="form-control" type="number" name="caida_presion_diseno_tubo" id="caida_presion_diseno_tubo" step="0.01">
                    </div>

                    <div class="col-12">
                        <label for="fouling_tubo">Fouling (m²C/W):</label>
                        <input class="form-control" type="number" name="fouling_tubo" id="fouling_tubo" step="0.00000001" required>
                    </div>

                    <div class="col-6">
                        <label for="conexiones_entrada_tubo">Conexiones de Entrada:</label>
                        <input class="form-control" type="text" maxlength="50" name="conexiones_entrada_tubo" id="conexiones_entrada_tubo">
                    </div>
                    <div class="col-6">
                        <label for="conexiones_salida_tubo">Conexiones de Salida:</label>
                        <input class="form-control" type="text" maxlength="50" name="conexiones_salida_tubo" id="conexiones_salida_tubo">
                    </div>
                </div>
            </div>

            <div class="col-12 d-flex justify-content-center">
                <button class="btn btn-secondary">+ Añadir Condición</button>
            </div>
        </div>
    
        <hr>

        <div class="row g-3">
            <div class="col-12">
                <h5 class="text-center" style="color: #e31e24;">Parámetros Adicionales</h5>
            </div>

            <div class="col-12">    
                <div class="row">                    
                    <div class="col-3">
                        <label for="calor">Calor (MW):</label>
                        <input class="form-control" type="number" name="calor" id="calor" step="0.0001" required>
                    </div>

                    <div class="col-3">
                        <label for="area">Área (m²):</label>
                        <input class="form-control" type="number" name="area" id="area" step="0.0001" required>
                    </div>

                    <div class="col-3">
                        <label for="arreglo_serie">Arreglo Serie:</label>
                        <input class="form-control" type="number" name="arreglo_serie" id="arreglo_serie" step="0.0001" required>
                    </div>

                    <div class="col-3">
                        <label for="arreglo_paralelo">Arreglo Paralelo:</label>
                        <input class="form-control" type="number" name="arreglo_paralelo" id="arreglo_paralelo" step="0.0001" required>
                    </div>

                    <div class="col-3">
                        <label for="no_tubos">No. Tubos:</label>
                        <input class="form-control" type="number" name="no_tubos" id="no_tubos" step="0.0001" required>
                    </div>

                    <div class="col-3">
                        <label for="longitud_tubos">Longitud Tubos (m):</label>
                        <input class="form-control" type="number" name="longitud_tubos" id="longitud_tubos" step="0.0001" required>
                    </div>

                    <div class="col-3">
                        <label for="tipo_tubo">Tipo de Tubo:</label>
                        <input class="form-control" type="number" name="tipo_tubo" id="tipo_tubo" step="0.0001" required>
                    </div>

                    <div class="col-3">
                        <label for="od_tubos">OD Tubos (mm):</label>
                        <input class="form-control" type="number" name="od_tubos" id="od_tubos" step="0.0001" required>
                    </div>

                    <div class="col-3">
                        <label for="pitch">Pitch (mm):</label>
                        <input class="form-control" type="number" name="pitch" id="pitch" step="0.0001" required>
                    </div>

                    <div class="col-3">
                        <label for="id_carcasa">ID Carcasa (m):</label>
                        <input class="form-control" type="number" name="id_carcasa" id="id_carcasa" step="0.0001" required>
                    </div>

                    <div class="col-3">
                        <label for="material_carcasa">Material Carcasa:</label>
                        <input class="form-control" type="text" name="material_carcasa" id="material_carcasa">
                    </div>

                    <div class="col-3">
                        <label for="material_tubo">Material Tubo:</label>
                        <input class="form-control" type="text" name="material_tubo" id="material_tubo">
                    </div>
                </div>
            </div>
        </div>

        <hr>
        
        <div class="d-flex justify-content-center mb-3">
            <button class="btn btn-danger">Registrar Intercambiador</button>
        </div>
    </form>
{% endblock %}

{% block extra_javascript %}
<script>
    let chart = null;
    let canvas = document.getElementById('grafica_1').getContext('2d');
    let datosGrafica = undefined;

    $('input.temperatura').change((e) => {
        canvas = document.getElementById('grafica_1').getContext('2d');
        
        if(chart)
            chart.destroy();

        let data = [{data: {}},{data: {}}];

        if($('#temp_in_tubo').val() !== ""){
            data[0].data.Inicial = Number($('#temp_in_tubo').val());
        }

        if($('#temp_out_carcasa').val() !== ""){
            data[0].data.Final = Number($('#temp_out_carcasa').val());
        }

        if($('#temp_in_tubo').val() !== ""){
            data[1].data.Inicial = Number($('#temp_in_tubo').val());
        }

        if($('#temp_out_tubo').val() !== ""){
            data[1].data.Final = Number($('#temp_out_tubo').val());
        }

        data[0].label = "Tubo Externo";
        data[0].backgroundColor = ['#E31E24'];
        data[0].borderColor = ['#E31E24'];

        data[1].label = "Tubo Interno";
        data[1].backgroundColor = ['#555'];
        data[1].borderColor = ['#555'];

        console.log(data);

        chart = new Chart(canvas, {
            type: 'line',
            data: {
                datasets: data
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Variación de las Temperaturas',
                        position: 'top'
                    },
                    legend: {
                        display: true
                    }
                }        
            }
        });
    
        console.log(chart.data);
    });

    chart = new Chart(canvas, {
            type: 'line',
            data: {
                datasets: [
                    {
                        label: "Tubo Externo",
                        data: {},
                        backgroundColor: ['#E31E24'],
                        borderColor: ['#E31E24']
                    },
                    {
                        label: "Tubo Interno",
                        data: {},
                        backgroundColor: ['#555'],
                        borderColor: ['#555']
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Variación de las Temperaturas',
                        position: 'top'
                    },
                    legend: {
                        display: true
                    }
                }        
            }
        });
</script>
{% endblock %}